var e=require("path"),t=require("fs-plus"),i=require("atom");function a(e){return e&&e.__esModule?e.default:e}var s=globalThis.parcelRequire7d67;(0,s.register)("L6JvT",function(n,o){Object.defineProperty(n.exports,"createMinimapPluginGeneratorElement",{get:()=>h,set:void 0,enumerable:!0,configurable:!0});var r=s("3HMiZ"),l=s("4r3v7"),c=e.resolve(__dirname,"../lib");let d="minimap-plugin-generator";class m extends HTMLElement{static initClass(){this.registerCommands(),(0,l.default)(this,d)}static registerCommands(){atom.commands.add("minimap-plugin-generator",{"core:confirm"(){this.confirm()},"core:cancel"(){this.detach()}})}createdCallback(){this.previouslyFocusedElement=null,this.mode=null,this.modal=document.createElement("atom-panel"),this.modal.classList.add("minimap-plugin-generator"),this.modal.classList.add("modal"),this.modal.classList.add("overlay"),this.modal.classList.add("from-top"),this.editor=atom.workspace.buildTextEditor({mini:!0}),this.editorElement=atom.views.getView(this.editor),this.error=document.createElement("div"),this.error.classList.add("error"),this.message=document.createElement("div"),this.message.classList.add("message"),this.modal.appendChild(this.editorElement),this.modal.appendChild(this.error),this.modal.appendChild(this.message),this.appendChild(this.modal)}connectedCallback(){this.previouslyFocusedElement=document.activeElement,this.message.textContent="Enter plugin path",this.setPathText("my-minimap-plugin"),this.editorElement.focus()}attach(){atom.views.getView(atom.workspace).appendChild(this)}setPathText(i,s){s||(s=[0,i.length]);let n=atom.config.get("core.projectHome")||process.env.ATOM_REPOS_HOME||a(e).join((0,t.getHomeDirectory)(),"github");this.editor.setText(a(e).join(n,i));let o=this.editor.getText().length-i.length;this.editor.setSelectedBufferRange([[0,o+s[0]],[0,o+s[1]]])}detach(){this.parentNode&&(this.previouslyFocusedElement&&this.previouslyFocusedElement.focus(),this.parentNode.removeChild(this))}confirm(){this.validPackagePath()&&(this.removeChild(this.modal),this.message.innerHTML=`
        <span class='loading loading-spinner-tiny inline-block'></span>
        Generate plugin at <span class="text-primary">${this.getPackagePath()}</span>
      `,this.createPackageFiles(()=>{let e=this.getPackagePath();atom.open({pathsToOpen:[e],devMode:atom.config.get("minimap.createPluginInDevMode")}),this.message.innerHTML='<span class="text-success">Plugin successfully generated, opening it now...</span>',setTimeout(()=>{this.detach()},2e3)}))}getPackagePath(){let t=this.editor.getText(),i=(0,r.dasherize)(a(e).basename(t));return a(e).join(a(e).dirname(t),i)}validPackagePath(){return!(0,t.existsSync)(this.getPackagePath())||(this.error.textContent=`Path already exists at '${this.getPackagePath()}'`,this.error.style.display="block",!1)}initPackage(t,i){let s=a(e).resolve(c,a(e).join("..","templates",`plugin-${this.template}`));p(atom.packages.getApmPath(),["init","-p",`${t}`,"--template",s],i)}createPackageFiles(t){let i=this.getPackagePath();!function(t){let i=a(e).join(atom.getConfigDirPath(),"packages",a(e).sep);if(0===t.indexOf(i))return!0;let s=a(e).join(atom.getConfigDirPath(),"dev","packages",a(e).sep);return 0===t.indexOf(s)}(i)?this.initPackage(i,()=>{!function(e,t){let i=["link"];atom.config.get("minimap.createPluginInDevMode")&&i.push("--dev"),i.push(e.toString()),p(atom.packages.getApmPath(),i,t)}(i,()=>{g(i,t)})}):this.initPackage(i,()=>{g(i,t)})}}function h(){let e=document.createElement(d);return e.createdCallback(),e}function g(e,t){p(atom.packages.getApmPath(),["install"],t,{cwd:e})}function p(e,t,a,s={}){return new i.BufferedProcess({command:e,args:t,exit:a,options:s})}m.initClass()});
//# sourceMappingURL=minimap-plugin-generator-element.f5282bf9.js.map
